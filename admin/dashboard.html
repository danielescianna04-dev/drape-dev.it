<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <base href="/admin/">
    <title>Dashboard Admin - Drape</title>
    <link rel="icon" type="image/svg+xml" href="../favicon.svg">
    <link rel="stylesheet" href="admin-styles.css">
    <!-- Chart.js for analytics -->
    <script data-cfasync="false" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="dashboard-layout">
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="40" height="40" rx="8" fill="url(#grad)"/>
                    <path d="M12 14h16v2H12v-2zm0 5h12v2H12v-2zm0 5h14v2H12v-2z" fill="white"/>
                    <defs>
                        <linearGradient id="grad" x1="0" y1="0" x2="40" y2="40">
                            <stop stop-color="#a855f7"/>
                            <stop offset="1" stop-color="#c084fc"/>
                        </linearGradient>
                    </defs>
                </svg>
                <h1>Drape</h1>
                <span>Admin</span>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Menu</div>
                    <a class="nav-item active" data-page="overview">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                        Overview
                    </a>
                    <a class="nav-item" data-page="users">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        Utenti
                        <span class="badge" id="usersBadge">0</span>
                    </a>
                    <a class="nav-item" data-page="projects">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                        </svg>
                        Progetti
                    </a>
                    <a class="nav-item" data-page="analytics">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                        Analytics
                    </a>
                    <a class="nav-item" data-page="report">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        Report
                    </a>
                    <a class="nav-item" data-page="published">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="2" y1="12" x2="22" y2="12"></line>
                            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                        </svg>
                        Siti Pubblicati
                        <span class="badge" id="publishedBadge">0</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Sistema</div>
                    <a class="nav-item" data-page="containers">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                        </svg>
                        Containers
                        <span class="badge" id="containersBadge">-</span>
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Admin</div>
                        <div class="user-role">Amministratore</div>
                    </div>
                    <button class="btn-logout" id="logoutBtn" title="Logout">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- OVERVIEW PAGE -->
            <section class="page-section active" id="page-overview">
                <div class="page-header">
                    <h2>Dashboard</h2>
                    <p>Panoramica generale della piattaforma Drape</p>
                </div>

                <!-- World Map - Active Users -->
                <div class="worldmap-card" id="worldmapCard">
                    <button class="worldmap-fullscreen-btn" id="worldmapFullscreenBtn" title="Schermo intero">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fs-expand">
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <polyline points="9 21 3 21 3 15"></polyline>
                            <line x1="21" y1="3" x2="14" y2="10"></line>
                            <line x1="3" y1="21" x2="10" y2="14"></line>
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fs-collapse" style="display:none;">
                            <polyline points="4 14 10 14 10 20"></polyline>
                            <polyline points="20 10 14 10 14 4"></polyline>
                            <line x1="14" y1="10" x2="21" y2="3"></line>
                            <line x1="3" y1="21" x2="10" y2="14"></line>
                        </svg>
                    </button>
                    <div class="worldmap-canvas-wrap">
                        <canvas id="worldmap-canvas"></canvas>
                    </div>
                    <div class="worldmap-overlay"></div>
                    <div class="worldmap-grid-overlay"></div>
                    <div class="worldmap-content">
                        <div class="worldmap-label-top">Drape Global Network</div>
                        <div class="worldmap-counter" id="worldmap-counter">
                            <span class="wm-digit">0</span>
                            <span class="wm-digit">0</span>
                            <span class="wm-separator">,</span>
                            <span class="wm-digit">0</span>
                            <span class="wm-digit">0</span>
                            <span class="wm-digit">0</span>
                        </div>
                        <div class="worldmap-label-bottom">UTENTI ATTIVI NEL MONDO</div>
                        <div class="worldmap-live">
                            <span class="wm-live-dot"></span>
                            LIVE
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card clickable" data-navigate="users">
                        <div class="stat-card-header">
                            <div class="stat-card-icon purple">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                            </div>
                            <span class="stat-card-trend up" id="usersTrend">+0%</span>
                        </div>
                        <div class="stat-card-value" id="totalUsers">-</div>
                        <div class="stat-card-label">Utenti Registrati</div>
                    </div>

                    <div class="stat-card clickable" data-action="show-online">
                        <div class="stat-card-header">
                            <div class="stat-card-icon green">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                            </div>
                            <span class="stat-card-trend up" id="activeTrend">+0%</span>
                        </div>
                        <div class="stat-card-value" id="activeUsers">-</div>
                        <div class="stat-card-label">Utenti Attivi</div>
                    </div>

                    <div class="stat-card clickable" data-navigate="projects">
                        <div class="stat-card-header">
                            <div class="stat-card-icon blue">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-card-value" id="totalProjects">-</div>
                        <div class="stat-card-breakdown">
                            <span class="breakdown-item"><span class="breakdown-dot git"></span><span id="gitProjects">-</span> Git</span>
                            <span class="breakdown-item"><span class="breakdown-dot app"></span><span id="appProjects">-</span> App</span>
                        </div>
                        <div class="stat-card-label">Progetti Totali</div>
                    </div>

                    <div class="stat-card clickable" data-navigate="containers">
                        <div class="stat-card-header">
                            <div class="stat-card-icon yellow">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-card-value" id="overviewActiveContainers">-</div>
                        <div class="stat-card-label">Containers In Uso</div>
                    </div>

                    <div class="stat-card" id="aiCostCard" style="cursor:pointer" title="Clicca per dettagli">
                        <div class="stat-card-header">
                            <div class="stat-card-icon purple">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-card-value" id="aiCostMonth">&euro;-</div>
                        <div class="stat-card-label">Costo AI (Mese)</div>
                    </div>
                </div>

                <!-- Recent Activity Table -->
                <div class="card">
                    <div class="card-header">
                        <h3>Sessioni Attive</h3>
                        <div class="actions" style="display:flex;align-items:center;gap:12px;">
                            <span id="lastUpdateTime" style="font-size:12px;color:var(--text-secondary);"></span>
                            <button class="btn-secondary" id="refreshSessions">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <polyline points="1 20 1 14 7 14"></polyline>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                                </svg>
                                Aggiorna
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Utente</th>
                                    <th>Accesso</th>
                                    <th>Online da</th>
                                    <th>Stato</th>
                                    <th>Ultimo ping</th>
                                    <th>Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="sessionsTableBody">
                                <tr>
                                    <td colspan="6" class="loading">
                                        <div class="loading-spinner"></div>
                                        Caricamento...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- USERS PAGE -->
            <section class="page-section" id="page-users">
                <div class="page-header">
                    <h2>Gestione Utenti</h2>
                    <p>Visualizza e gestisci gli utenti registrati</p>
                </div>

                <div class="filters-bar">
                    <div class="search-wrapper">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" class="search-input" id="userSearch" placeholder="Cerca utente...">
                    </div>
                    <select class="filter-select" id="planFilter">
                        <option value="">Tutti i piani</option>
                        <option value="free">Free</option>
                        <option value="go">Go</option>
                        <option value="starter">Starter</option>
                        <option value="pro">Pro</option>
                        <option value="team">Team</option>
                    </select>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Lista Utenti</h3>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Utente</th>
                                    <th>Piano</th>
                                    <th>Stato</th>
                                    <th>Posizione</th>
                                    <th>Registrato</th>
                                    <th>Ultimo accesso</th>
                                    <th>Utilizzo AI</th>
                                    <th>Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr>
                                    <td colspan="8" class="loading">
                                        <div class="loading-spinner"></div>
                                        Caricamento...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- PROJECTS PAGE -->
            <section class="page-section" id="page-projects">
                <div class="page-header">
                    <h2>Progetti</h2>
                    <p>Visualizza tutti i progetti creati dagli utenti</p>
                </div>

                <div class="filters-bar">
                    <div class="search-wrapper">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" class="search-input" id="projectSearch" placeholder="Cerca progetto...">
                    </div>
                    <select class="filter-select" id="templateFilter">
                        <option value="">Tutti i template</option>
                        <option value="nextjs">Next.js</option>
                        <option value="vite-react">Vite React</option>
                        <option value="html">HTML</option>
                        <option value="expo">Expo</option>
                    </select>
                </div>

                <div class="projects-grid" id="projectsGrid">
                    <div class="loading" style="grid-column: 1/-1;">
                        <div class="loading-spinner"></div>
                        Caricamento...
                    </div>
                </div>
            </section>

            <!-- ANALYTICS PAGE -->
            <section class="page-section" id="page-analytics">
                <div class="page-header">
                    <h2>Analytics</h2>
                    <p>Statistiche e metriche della piattaforma</p>
                </div>

                <div class="charts-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Utenti Attivi (7 giorni)</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="usersChart"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Costi AI per Modello</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="aiCostChart"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Operazioni Frequenti</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="operationsChart"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Distribuzione Piani</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="plansChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CONTAINERS PAGE -->
            <section class="page-section" id="page-containers">
                <div class="page-header">
                    <h2>Containers Docker</h2>
                    <p>Gestisci i containers attivi sulla piattaforma</p>
                </div>

                <!-- Server Resources -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header">
                        <h3>Risorse Server</h3>
                        <span id="serverUptime" style="font-size:12px;color:var(--text-secondary);"></span>
                    </div>
                    <div style="padding: 16px 24px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                        <div>
                            <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                                <span style="font-size:13px;color:var(--text-secondary);">CPU</span>
                                <span style="font-size:13px;color:var(--text);" id="cpuInfo">-</span>
                            </div>
                            <div class="progress-bar" style="display:flex;">
                                <div id="cpuBarSystem" style="height:100%;background:#f97316;transition:width 0.4s ease;border-radius:4px 0 0 4px;"></div>
                                <div id="cpuBarContainers" style="height:100%;background:#a855f7;transition:width 0.4s ease;border-radius:0 4px 4px 0;"></div>
                            </div>
                            <div style="display:flex;gap:12px;margin-top:4px;">
                                <span style="font-size:10px;color:var(--text-muted);display:flex;align-items:center;gap:4px;"><span style="width:8px;height:8px;border-radius:50%;background:#f97316;display:inline-block;"></span>Sistema</span>
                                <span style="font-size:10px;color:var(--text-muted);display:flex;align-items:center;gap:4px;"><span style="width:8px;height:8px;border-radius:50%;background:#a855f7;display:inline-block;"></span>Containers</span>
                            </div>
                        </div>
                        <div>
                            <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                                <span style="font-size:13px;color:var(--text-secondary);">RAM</span>
                                <span style="font-size:13px;color:var(--text);" id="ramInfo">-</span>
                            </div>
                            <div class="progress-bar" style="display:flex;">
                                <div id="ramBarSystem" style="height:100%;background:#f97316;transition:width 0.4s ease;border-radius:4px 0 0 4px;"></div>
                                <div id="ramBarContainers" style="height:100%;background:#a855f7;transition:width 0.4s ease;border-radius:0 4px 4px 0;"></div>
                            </div>
                            <div style="display:flex;gap:12px;margin-top:4px;">
                                <span style="font-size:10px;color:var(--text-muted);display:flex;align-items:center;gap:4px;"><span style="width:8px;height:8px;border-radius:50%;background:#f97316;display:inline-block;"></span>Sistema</span>
                                <span style="font-size:10px;color:var(--text-muted);display:flex;align-items:center;gap:4px;"><span style="width:8px;height:8px;border-radius:50%;background:#a855f7;display:inline-block;"></span>Containers</span>
                            </div>
                        </div>
                        <div>
                            <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                                <span style="font-size:13px;color:var(--text-secondary);">Disco</span>
                                <span style="font-size:13px;color:var(--text);" id="diskInfo">-</span>
                            </div>
                            <div class="progress-bar" style="display:flex;">
                                <div id="diskBarSystem" style="height:100%;background:#f97316;transition:width 0.4s ease;border-radius:4px 0 0 4px;"></div>
                                <div id="diskBarContainers" style="height:100%;background:#a855f7;transition:width 0.4s ease;border-radius:0 4px 4px 0;"></div>
                            </div>
                            <div style="display:flex;gap:12px;margin-top:4px;">
                                <span style="font-size:10px;color:var(--text-muted);display:flex;align-items:center;gap:4px;"><span style="width:8px;height:8px;border-radius:50%;background:#f97316;display:inline-block;"></span>Sistema</span>
                                <span style="font-size:10px;color:var(--text-muted);display:flex;align-items:center;gap:4px;"><span style="width:8px;height:8px;border-radius:50%;background:#a855f7;display:inline-block;"></span>Containers</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Container Stats Cards -->
                <div class="stats-grid" style="margin-bottom: 16px;">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon green">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-card-value"><span id="activeContainers">-</span><span id="maxContainersSlash" style="font-size:18px;color:var(--text-muted);font-weight:400;"></span></div>
                        <div class="stat-card-label">In Uso</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon yellow">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="10" y1="15" x2="10" y2="9"></line>
                                    <line x1="14" y1="15" x2="14" y2="9"></line>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-card-value" id="idleContainers">-</div>
                        <div class="stat-card-label">Idle</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon purple">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
                                    <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
                                    <line x1="6" y1="6" x2="6.01" y2="6"></line>
                                    <line x1="6" y1="18" x2="6.01" y2="18"></line>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-card-value" id="totalContainersCount">-</div>
                        <div class="stat-card-label">Totale</div>
                    </div>

                </div>

                <!-- Container & Server specs info -->
                <div class="card" style="margin-bottom:24px;padding:16px 20px;">
                    <div style="display:flex;gap:28px;flex-wrap:wrap;">
                        <!-- Risorse totali server -->
                        <div style="flex:1;min-width:180px;">
                            <div style="font-size:12px;color:var(--text-muted);font-weight:600;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:10px;">Risorse totali server</div>
                            <div style="display:flex;flex-direction:column;gap:6px;">
                                <div style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text-secondary);">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#a855f7" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                                    <span id="serverSpecRam">125 GB RAM</span>
                                </div>
                                <div style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text-secondary);">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2"><rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg>
                                    <span id="serverSpecCpu">32 CPU cores</span>
                                </div>
                                <div style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text-secondary);">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
                                    <span id="serverSpecDisk">1.7 TB NVMe SSD</span>
                                </div>
                            </div>
                        </div>
                        <!-- Divider -->
                        <div style="width:1px;background:var(--border);align-self:stretch;"></div>
                        <!-- Uso del sistema -->
                        <div style="flex:1;min-width:180px;">
                            <div style="font-size:12px;color:var(--text-muted);font-weight:600;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:10px;">Uso del sistema</div>
                            <div style="display:flex;flex-direction:column;gap:6px;">
                                <div style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text-secondary);">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                                    <span id="systemRamUsage">- RAM</span>
                                </div>
                                <div style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text-secondary);">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2"><rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg>
                                    <span id="systemCpuUsage">- CPU</span>
                                </div>
                                <div style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text-secondary);">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
                                    <span id="systemDiskUsage">- disco</span>
                                </div>
                                <div style="display:flex;align-items:center;gap:8px;font-size:11px;color:var(--text-muted);padding-left:22px;">
                                    OS, Docker, backend, Nginx
                                </div>
                            </div>
                        </div>
                        <!-- Divider -->
                        <div style="width:1px;background:var(--border);align-self:stretch;"></div>
                        <!-- Per ogni container -->
                        <div style="flex:1;min-width:180px;">
                            <div style="font-size:12px;color:var(--text-muted);font-weight:600;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:10px;">Per ogni container</div>
                            <div style="display:flex;flex-direction:column;gap:6px;">
                                <div style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text-secondary);">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#a855f7" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                                    <span id="containerSpecRam">4 GB RAM dedicata</span>
                                </div>
                                <div style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text-secondary);">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2"><rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg>
                                    <span id="containerSpecCpu">4 CPU cores dedicati</span>
                                </div>
                                <div style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text-secondary);">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#eab308" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                    30 min idle timeout
                                </div>
                                <div style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text-secondary);">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
                                    NVMe storage (bind mount)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Containers Table -->
                <div class="card">
                    <div class="card-header">
                        <h3>Containers</h3>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Container</th>
                                    <th>Utente</th>
                                    <th>Stato</th>
                                    <th>Utilizzo</th>
                                    <th>CPU</th>
                                    <th>RAM (uso / limite)</th>
                                    <th>Network I/O</th>
                                    <th>Avviato da</th>
                                </tr>
                            </thead>
                            <tbody id="containersTableBody">
                                <tr>
                                    <td colspan="8" class="loading">
                                        <div class="loading-spinner"></div>
                                        Caricamento...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ========== PUBLISHED SITES PAGE ========== -->
            <section class="page-section" id="page-published">
                <h2>Siti Pubblicati</h2>
                <p class="page-subtitle">Siti deployati dagli utenti della piattaforma</p>

                <div class="stats-grid" style="margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon green">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="2" y1="12" x2="22" y2="12"></line>
                                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-card-value" id="totalPublished">-</div>
                        <div class="stat-card-label">Siti Totali</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Lista Siti</h3>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Sito</th>
                                    <th>Pubblicato da</th>
                                    <th>Progetto</th>
                                    <th>Data</th>
                                    <th>Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="publishedTableBody">
                                <tr>
                                    <td colspan="5" class="loading">
                                        <div class="loading-spinner"></div>
                                        Caricamento...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- REPORT PAGE -->
            <section class="page-section" id="page-report">
                <div class="page-header">
                    <h2>Report Attività</h2>
                    <p>Storico utenti online e registrazioni dal primo account</p>
                </div>

                <!-- Controls -->
                <div class="report-controls">
                    <div class="report-range-buttons">
                        <button class="report-btn active" data-range="7d">7 giorni</button>
                        <button class="report-btn" data-range="30d">30 giorni</button>
                        <button class="report-btn" data-range="90d">3 mesi</button>
                        <button class="report-btn" data-range="all">Tutto</button>
                    </div>
                    <div class="report-date-range">
                        <input type="date" id="reportDateFrom" class="report-date-input">
                        <span style="color:var(--text-muted);">→</span>
                        <input type="date" id="reportDateTo" class="report-date-input">
                        <button class="report-btn" id="reportApplyDates">Applica</button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="report-summary">
                    <div class="report-summary-card">
                        <div class="report-summary-value" id="reportTotalUsers">-</div>
                        <div class="report-summary-label">Utenti Totali</div>
                    </div>
                    <div class="report-summary-card">
                        <div class="report-summary-value" id="reportNewUsersRange">-</div>
                        <div class="report-summary-label">Nuove Registrazioni</div>
                    </div>
                    <div class="report-summary-card">
                        <div class="report-summary-value" id="reportActiveUsersRange">-</div>
                        <div class="report-summary-label">Utenti Attivi (periodo)</div>
                    </div>
                    <div class="report-summary-card">
                        <div class="report-summary-value" id="reportPeakDay">-</div>
                        <div class="report-summary-label">Giorno di Picco</div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="report-charts">
                    <div class="card" style="padding:20px;">
                        <h3 style="margin:0 0 16px;font-size:15px;color:var(--text);">Utenti Attivi per Giorno</h3>
                        <div class="chart-container" style="height:300px;">
                            <canvas id="reportActiveChart"></canvas>
                        </div>
                    </div>
                    <div class="card" style="padding:20px;">
                        <h3 style="margin:0 0 16px;font-size:15px;color:var(--text);">Nuove Registrazioni per Giorno</h3>
                        <div class="chart-container" style="height:300px;">
                            <canvas id="reportNewUsersChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Crescita Totale -->
                <div class="card" style="padding:20px;margin-top:16px;">
                    <div style="display:flex;justify-content:space-between;align-items:baseline;margin-bottom:16px;">
                        <h3 style="margin:0;font-size:15px;color:var(--text);">Utenti Registrati Totali nel Tempo</h3>
                        <span style="font-size:12px;color:var(--text-muted);">Quanti utenti totali avevamo ogni giorno</span>
                    </div>
                    <div class="chart-container" style="height:250px;">
                        <canvas id="reportGrowthChart"></canvas>
                    </div>
                </div>

                <!-- Daily Detail Table -->
                <div class="card" style="margin-top:16px;">
                    <div class="card-header" style="display:flex;justify-content:space-between;align-items:center;padding:16px 20px;">
                        <h3 style="margin:0;font-size:15px;color:var(--text);">Dettaglio Giornaliero</h3>
                        <input type="text" class="search-input" id="reportDaySearch" placeholder="Cerca data o email...">
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Nuovi Utenti</th>
                                    <th>Utenti Attivi</th>
                                    <th>Totale Utenti</th>
                                    <th>Dettagli</th>
                                </tr>
                            </thead>
                            <tbody id="reportTableBody">
                                <tr>
                                    <td colspan="5" class="loading">
                                        <div class="loading-spinner"></div>
                                        Caricamento...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Modal Utenti Online -->
    <div id="onlineUsersModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Utenti Online</h3>
                <button class="modal-close" id="closeOnlineModal">&times;</button>
            </div>
            <div class="modal-body" id="onlineUsersModalBody">
                <div class="loading"><div class="loading-spinner"></div> Caricamento...</div>
            </div>
        </div>
    </div>

    <!-- Modal Costi AI -->
    <div id="aiCostModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Costi AI - Dettaglio Mensile</h3>
                <button class="modal-close" id="closeAiCostModal">&times;</button>
            </div>
            <div class="modal-body" id="aiCostModalBody">
                <div class="loading"><div class="loading-spinner"></div> Caricamento...</div>
            </div>
        </div>
    </div>

    <script data-cfasync="false" src="admin.js" type="module"></script>
</body>
</html>
